#Join Frames

```{r echo=FALSE, warning=FALSE, error=FALSE, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
detach("package:plyr", unload=TRUE)
detach("package:dplyr", unload=TRUE)
library(knitr)
library(tidyr)

library(dplyr)
#library(plyr)

library(lubridate)
library(magrittr)
library(dummies)

#Load files
load('processed_files/account')
load('processed_files/card')
load('processed_files/client')
load('processed_files/demographic')
load('processed_files/disposition')
load('processed_files/loan')
load('processed_files/order')

#load('processed_files/transaction')
```


To make calculations easier two combinations were made, one with every table but the transactions in wich the granularity was the account, the clients were agregated to show only the account owner and the number of the dependants in the account. The other combination included every table and the granularity was the single transaction, it was a join betwen the transactions and the previus combination.

## Join frames without transactions:


```{r echo = TRUE, warning=FALSE}

#Base frame accounts 
frame_no_transaction <- account %>%
  #Join accounts
  left_join(loan, by = 'account_id') %>%
  #Join Demographic
  left_join(demographic, by = 'district_id') %>%
  #Join disposition
  left_join(
    dplyr::filter(disposition, type == 'OWNER' ) %>% 
      left_join(disposition %>% group_by(account_id) %>% dplyr::summarise(dependants = n()-1), by = 'account_id')
    , by = 'account_id') %>%
  #Join client
  left_join(client,by = 'client_id') %>%
  #Join card
  left_join(card, by = 'disp_id') %>%
  #Join order
  left_join(order, by = 'account_id') %>%
  #Join transactions 
  left_join(
    transaction %>% group_by(account_id) %>% dplyr::summarise(amount_transactions = sum(amount)),
    by = 'account_id')

```

``` {r echo = FALSE, warning=FALSE}

save(frame_no_transaction,file = 'processed_files/frame_no_transaction')

```



## Join frames with transactions:

```{r echo = TRUE, warning=FALSE}

# Join previus frame with transactionns
frame <- transaction %>% left_join(frame_no_transaction, by = 'account_id')

```

``` {r echo = FALSE, warning=FALSE}
save(frame,file = 'processed_files/frame')
```
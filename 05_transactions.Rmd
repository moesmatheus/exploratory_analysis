# Transactions

```{r echo=FALSE, warning=FALSE, error=FALSE, include=FALSE}

library(plotly)
library(ggplot2)
library(lubridate)



```



##Amount of transactions annually

The amount of transactions done by the bank is growing continuously, showing the bank's growth. The majority of those transactions involves physical cash, either withdrawal or credit, and those are the most important drivers in the transaction's growth. The share of credit card in the banks transactions is very small.

This indicates an opportunity of growth from offering more credit cards and making incentives for the clients to use them.

```{r fig.cap='Amount of transactions annually', echo=FALSE, warning=FALSE, error=FALSE}


transaction %>% 
  mutate( date = lubridate::floor_date(date, 'year') ) %>% 
  group_by(date, operation) %>% 
  summarise(amount = sum(amount)/1e6) %>% dplyr::filter(operation!="") %>%
  ggplot() +
  geom_col(aes(x=date, y = amount, fill = operation)) +
  labs(y='Total transactions (millions)',x = 'Year') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```

##Net transactions amount annually

We can see that in every year on the time series the net flow of transactions is positive, which indicates that the bank shouldn't have a liquidity problem.

```{r fig.cap='Net transactions amount annually', echo=FALSE, warning=FALSE, error=FALSE}


transaction %>% 
  mutate(movement = ifelse(type == 'credit', amount, -amount), date = lubridate::floor_date(date, 'year') ) %>% 
  group_by(date) %>% 
  summarise(movement = sum(movement)/1e6) %>%
ggplot() +
  geom_col(aes(x=date, y = movement)) +
    labs(y='Cash Flow (millions)',x = 'Year') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```

##Net transactions amount monthly

If we take a closer look to the transactions monthly, we can that on every January and June of every year there is a negative flow of transactions, specially on January. Those negative flows should be a cause for concern to the bank and it should be more cautious on those months.

```{r fig.cap='Net transactions amount monthly', echo=FALSE, warning=FALSE, error=FALSE}


transaction %>% 
  mutate(movement = ifelse(type == 'credit', amount, -amount), date = lubridate::floor_date(date, 'month') ) %>% 
  group_by(date) %>% 
  summarise(movement = sum(movement)/1e6) %>%
ggplot() +
  geom_col(aes(x=date, y = movement)) +
    labs(y='Cash Flow (millions)',x = 'Month') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```

Looking in the types of transactions we can see that the negative cash flow is caused by a surge in the number of withdrawals.

```{r fig.cap='Cash Flow Year by Year', echo=FALSE, warning=FALSE, error=FALSE}


transaction %>% 
  mutate( amount = ifelse(type == 'credit', amount, -amount), date = lubridate::floor_date(date, 'month') ) %>% 
  group_by(date, operation) %>% 
  summarise(amount = sum(amount)/1e6) %>% dplyr::filter(operation!="") %>%
  ggplot() +
  geom_col(aes(x=date, y = amount, fill = operation), position = 'identity', alpha = 0.3) +
  labs(y='Cash Flow (millions)',x = 'Year') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```


From the products categorized by the bank we can see that household has the fastest growth, even though it and the other products are going through a period of stagnation recently.

```{r fig.cap='Cash Flow Year by Year', echo=FALSE, warning=FALSE, error=FALSE}


transaction %>% 
  mutate( date = lubridate::floor_date(date, 'month') ) %>% 
  group_by(date, k_symbol) %>% 
  summarise(amount = sum(amount)/1e6) %>% dplyr::filter(k_symbol!="") %>%
  ggplot() +
  geom_col(aes(x=date, y = amount, fill = k_symbol),position = "identity", alpha = 0.4) +
  labs(y='Total transactions (millions)',x = 'Year') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```











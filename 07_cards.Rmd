#Cards
##Card type
The majority of the cards issued by the bank are of the classic type.

Since credit cards are not yet widely used by customers, offering premium cards can be a good opportunity to encourage their use.


```{r fig.cap='Card Type', echo=FALSE, warning=FALSE, error=FALSE}


frame_no_transaction %>% group_by(type.y) %>% summarise(n = n()) %>%
dplyr::filter(type.y!='') %>%
  ggplot() +
  geom_col(aes(x = type.y, y = n)) +
  labs(y='',x = 'Card Type') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```

##Card type issued by year
There has been an increase in the number of cards issued by the bank pushed mostly by the classic card.

```{r fig.cap='Cards issued by year', echo=FALSE, warning=FALSE, error=FALSE}


frame_no_transaction %>% 
  mutate( date = lubridate::floor_date(issued, 'year') ) %>% 
  group_by(date, type.y) %>% 
  summarise(amount = n()) %>%
  ggplot() +
  geom_col(aes(x=date, y = amount, fill = type.y)) +
  labs(y='Cards Issued',x = 'Year') -> p

if (pdf){
  p
} else {
ggplotly(p)
}


```

##Credit card transactions by type
The growth in the number of credit cards has also been accompanied by a grow in the number of transactions done by credit card, mostly in the classic card.


```{r fig.cap='Amount of transactions by card type', echo=FALSE, warning=FALSE, error=FALSE}


frame %>% 
  mutate( date = lubridate::floor_date(date, 'year') ) %>% 
  group_by(date, operation, type.y) %>% 
  summarise(amount = sum(amount.x)/1e6) %>% dplyr::filter(operation=="credit card withdrawal") %>%
  ggplot() +
  geom_col(aes(x=date, y = amount, fill = type.y)) +
  labs(y='Transaction Amount (Millions)',x = 'Year') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```

##Credit card transactions by type
The growth in the number of credit cards has also been accompanied by a grow in the number of transactions done by credit card, mostly in the classic card.


```{r fig.cap='Amount of transactions by card type', echo=FALSE, warning=FALSE, error=FALSE}


frame %>% 
  mutate( date = lubridate::floor_date(date, 'year') ) %>% 
  group_by(date, operation, type.y) %>% 
  summarise(amount = sum(amount.x)/1e6) %>% dplyr::filter(operation=="credit card withdrawal") %>%
  ggplot() +
  geom_col(aes(x=date, y = amount, fill = type.y)) +
  labs(y='Transaction Amount (Millions)',x = 'Year') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```

##Credit card transactions by month

As it happens with the amount of transactions there is also a spike in the use of credit cards every year in January, especially amongst the users of the classic card.

```{r fig.cap='Amount of transactions by month', echo=FALSE, warning=FALSE, error=FALSE}


frame %>% 
  mutate( date = lubridate::floor_date(date, 'month') ) %>% 
  dplyr::filter(operation=="credit card withdrawal") %>%
  group_by(date, type.y) %>% 
  summarise(amount = sum(amount.x)/1e6) %>% 
  ggplot() +
  geom_col(aes(x=date, y = amount, fill = type.y)) +
  labs(y='Transaction Amount (Millions)',x = 'Month') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```

## Amount of card transactions by account

The gold card has a slightly higher volume of transactions per client then the other cards. Looking at the clients with the classic card we see that there is a great number of outliers regarding the total of transactions with the card, those clients could be updated to the gold card.

```{r fig.cap='Amount of card transactions by account', echo=FALSE, warning=FALSE, error=FALSE}


frame %>% 
  dplyr::filter(operation=="credit card withdrawal") %>%
  group_by(account_id) %>% 
  summarise(amount = sum(amount.x)/1e3, type.y = first(type.y)) %>% 
  ggplot() +
    geom_boxplot(aes(x= type.y, y = amount, fill = type.y)) +
    labs(y='',x = 'Transactions on card by account (Thousands)') -> p

if (pdf){
  p
} else {
ggplotly(p)
}

```







